<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Evidence Tagging System - EVID-DGC</title>\n    <link rel=\"stylesheet\" href=\"styles.css\">\n    <style>\n        .tagging-container {\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n\n        .tagging-header {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 30px;\n            border-radius: 10px;\n            margin-bottom: 30px;\n            text-align: center;\n        }\n\n        .tagging-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin-bottom: 30px;\n        }\n\n        .tagging-section {\n            background: white;\n            border-radius: 10px;\n            padding: 25px;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n        }\n\n        .section-title {\n            font-size: 1.5rem;\n            font-weight: 600;\n            margin-bottom: 20px;\n            color: #2d3748;\n            border-bottom: 2px solid #e2e8f0;\n            padding-bottom: 10px;\n        }\n\n        /* Tag Input Styles */\n        .tag-input-container {\n            position: relative;\n        }\n\n        .selected-tags {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n            margin-bottom: 15px;\n            min-height: 40px;\n            padding: 10px;\n            border: 2px dashed #e2e8f0;\n            border-radius: 8px;\n        }\n\n        .selected-tag {\n            display: inline-flex;\n            align-items: center;\n            padding: 6px 12px;\n            background-color: #3b82f6;\n            color: white;\n            border-radius: 20px;\n            font-size: 0.875rem;\n            font-weight: 500;\n        }\n\n        .remove-tag {\n            background: none;\n            border: none;\n            color: white;\n            margin-left: 8px;\n            cursor: pointer;\n            font-size: 1.2rem;\n            line-height: 1;\n        }\n\n        .tag-input {\n            width: 100%;\n            padding: 12px;\n            border: 2px solid #e2e8f0;\n            border-radius: 8px;\n            font-size: 1rem;\n            outline: none;\n            transition: border-color 0.2s;\n        }\n\n        .tag-input:focus {\n            border-color: #3b82f6;\n        }\n\n        .tag-suggestions {\n            position: absolute;\n            top: 100%;\n            left: 0;\n            right: 0;\n            background: white;\n            border: 1px solid #e2e8f0;\n            border-radius: 8px;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n            max-height: 200px;\n            overflow-y: auto;\n            z-index: 1000;\n        }\n\n        .tag-suggestion {\n            display: flex;\n            align-items: center;\n            padding: 12px;\n            cursor: pointer;\n            transition: background-color 0.2s;\n        }\n\n        .tag-suggestion:hover {\n            background-color: #f7fafc;\n        }\n\n        .tag-color {\n            width: 16px;\n            height: 16px;\n            border-radius: 50%;\n            margin-right: 10px;\n        }\n\n        .tag-name {\n            flex: 1;\n            font-weight: 500;\n        }\n\n        .tag-usage {\n            font-size: 0.875rem;\n            color: #718096;\n            background: #edf2f7;\n            padding: 2px 8px;\n            border-radius: 12px;\n        }\n\n        /* Tag Filter Styles */\n        .tag-filter-container {\n            border: 1px solid #e2e8f0;\n            border-radius: 8px;\n            padding: 20px;\n        }\n\n        .filter-controls {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 20px;\n        }\n\n        .filter-logic {\n            padding: 8px 12px;\n            border: 1px solid #e2e8f0;\n            border-radius: 6px;\n            font-size: 0.875rem;\n        }\n\n        .clear-filter {\n            padding: 8px 16px;\n            background: #ef4444;\n            color: white;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 0.875rem;\n        }\n\n        .tag-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\n            gap: 10px;\n            margin-top: 15px;\n        }\n\n        .available-tag {\n            display: flex;\n            align-items: center;\n            padding: 10px;\n            background: #f7fafc;\n            border: 1px solid #e2e8f0;\n            border-radius: 6px;\n            cursor: pointer;\n            transition: all 0.2s;\n            font-size: 0.875rem;\n        }\n\n        .available-tag:hover {\n            background: #edf2f7;\n            transform: translateY(-1px);\n        }\n\n        .tag-count {\n            margin-left: auto;\n            background: #3b82f6;\n            color: white;\n            padding: 2px 6px;\n            border-radius: 10px;\n            font-size: 0.75rem;\n        }\n\n        .filter-tag-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n            margin-top: 15px;\n        }\n\n        .filter-tag {\n            display: inline-flex;\n            align-items: center;\n            padding: 6px 12px;\n            color: white;\n            border-radius: 20px;\n            font-size: 0.875rem;\n            font-weight: 500;\n        }\n\n        .remove-filter-tag {\n            background: none;\n            border: none;\n            color: white;\n            margin-left: 8px;\n            cursor: pointer;\n            font-size: 1.2rem;\n            line-height: 1;\n        }\n\n        /* Evidence Table Styles */\n        .evidence-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 20px;\n        }\n\n        .evidence-table th,\n        .evidence-table td {\n            padding: 12px;\n            text-align: left;\n            border-bottom: 1px solid #e2e8f0;\n        }\n\n        .evidence-table th {\n            background: #f7fafc;\n            font-weight: 600;\n            color: #2d3748;\n        }\n\n        .evidence-tags {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 4px;\n        }\n\n        .evidence-tag {\n            padding: 2px 8px;\n            color: white;\n            border-radius: 12px;\n            font-size: 0.75rem;\n            font-weight: 500;\n        }\n\n        /* Batch Operations */\n        .batch-operations {\n            background: #f7fafc;\n            padding: 20px;\n            border-radius: 8px;\n            margin-bottom: 20px;\n        }\n\n        .batch-controls {\n            display: flex;\n            gap: 15px;\n            align-items: center;\n            flex-wrap: wrap;\n        }\n\n        .batch-button {\n            padding: 10px 20px;\n            background: #3b82f6;\n            color: white;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 0.875rem;\n            transition: background-color 0.2s;\n        }\n\n        .batch-button:hover {\n            background: #2563eb;\n        }\n\n        .batch-button:disabled {\n            background: #9ca3af;\n            cursor: not-allowed;\n        }\n\n        /* Error Display */\n        .tag-error {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: #ef4444;\n            color: white;\n            padding: 15px 20px;\n            border-radius: 8px;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n            z-index: 2000;\n            display: none;\n        }\n\n        /* Responsive Design */\n        @media (max-width: 768px) {\n            .tagging-grid {\n                grid-template-columns: 1fr;\n            }\n            \n            .batch-controls {\n                flex-direction: column;\n                align-items: stretch;\n            }\n            \n            .tag-grid {\n                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"tagging-container\">\n        <div class=\"tagging-header\">\n            <h1>üè∑Ô∏è Evidence Tagging System</h1>\n            <p>Organize and categorize evidence with flexible multi-dimensional tagging</p>\n        </div>\n\n        <div class=\"tagging-grid\">\n            <!-- Tag Creation Section -->\n            <div class=\"tagging-section\">\n                <h2 class=\"section-title\">Create New Tag</h2>\n                <div id=\"tag-creator\">\n                    <div class=\"form-group\">\n                        <label for=\"tag-name\">Tag Name:</label>\n                        <input type=\"text\" id=\"tag-name\" placeholder=\"Enter tag name...\" class=\"tag-input\">\n                    </div>\n                    <div class=\"form-group\">\n                        <label for=\"tag-color\">Color:</label>\n                        <input type=\"color\" id=\"tag-color\" value=\"#3B82F6\">\n                    </div>\n                    <div class=\"form-group\">\n                        <label for=\"tag-category\">Category:</label>\n                        <select id=\"tag-category\">\n                            <option value=\"general\">General</option>\n                            <option value=\"priority\">Priority</option>\n                            <option value=\"status\">Status</option>\n                            <option value=\"type\">Type</option>\n                            <option value=\"sensitivity\">Sensitivity</option>\n                        </select>\n                    </div>\n                    <button type=\"button\" id=\"create-tag-btn\" class=\"batch-button\">Create Tag</button>\n                </div>\n            </div>\n\n            <!-- Tag Filter Section -->\n            <div class=\"tagging-section\">\n                <h2 class=\"section-title\">Filter Evidence by Tags</h2>\n                <div id=\"tag-filter\"></div>\n            </div>\n        </div>\n\n        <!-- Batch Operations Section -->\n        <div class=\"tagging-section\">\n            <h2 class=\"section-title\">Batch Tag Operations</h2>\n            <div class=\"batch-operations\">\n                <div class=\"batch-controls\">\n                    <button type=\"button\" id=\"select-all-btn\" class=\"batch-button\">Select All</button>\n                    <button type=\"button\" id=\"clear-selection-btn\" class=\"batch-button\">Clear Selection</button>\n                    <div id=\"batch-tag-input\"></div>\n                    <button type=\"button\" id=\"apply-batch-tags-btn\" class=\"batch-button\" disabled>Apply Tags to Selected</button>\n                </div>\n                <div id=\"selection-info\" style=\"margin-top: 15px; font-size: 0.875rem; color: #718096;\"></div>\n            </div>\n        </div>\n\n        <!-- Evidence Table Section -->\n        <div class=\"tagging-section\">\n            <h2 class=\"section-title\">Evidence Items</h2>\n            <div id=\"evidence-container\">\n                <table class=\"evidence-table\" id=\"evidence-table\">\n                    <thead>\n                        <tr>\n                            <th><input type=\"checkbox\" id=\"select-all-checkbox\"></th>\n                            <th>ID</th>\n                            <th>Name</th>\n                            <th>Type</th>\n                            <th>Tags</th>\n                            <th>Actions</th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"evidence-tbody\">\n                        <!-- Evidence items will be loaded here -->\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n\n    <!-- Scripts -->\n    <script src=\"storage.js\"></script>\n    <script src=\"tag-manager.js\"></script>\n    <script>\n        let tagManager;\n        let selectedEvidence = new Set();\n        let batchTagInput;\n        \n        // Mock evidence data for demonstration\n        const mockEvidence = [\n            { id: 1, name: 'Security Camera Footage', type: 'video/mp4', tags: [1, 2] },\n            { id: 2, name: 'Witness Statement', type: 'application/pdf', tags: [4] },\n            { id: 3, name: 'Crime Scene Photo', type: 'image/jpeg', tags: [1, 5] },\n            { id: 4, name: 'Forensic Report', type: 'application/pdf', tags: [6, 3] },\n            { id: 5, name: 'Audio Recording', type: 'audio/mp3', tags: [2, 4] }\n        ];\n\n        // Initialize the tagging system\n        async function initializeTagging() {\n            const userWallet = localStorage.getItem('userWallet') || '0x1234567890123456789012345678901234567890';\n            tagManager = new TagManager(userWallet);\n            \n            // Wait for tags to load\n            await new Promise(resolve => setTimeout(resolve, 1000));\n            \n            setupTagCreator();\n            setupTagFilter();\n            setupBatchOperations();\n            loadEvidenceTable();\n        }\n\n        // Setup tag creator\n        function setupTagCreator() {\n            const createBtn = document.getElementById('create-tag-btn');\n            const nameInput = document.getElementById('tag-name');\n            const colorInput = document.getElementById('tag-color');\n            const categorySelect = document.getElementById('tag-category');\n\n            createBtn.addEventListener('click', async () => {\n                const name = nameInput.value.trim();\n                const color = colorInput.value;\n                const category = categorySelect.value;\n\n                if (!name) {\n                    alert('Please enter a tag name');\n                    return;\n                }\n\n                try {\n                    await tagManager.createTag(name, color, category);\n                    nameInput.value = '';\n                    colorInput.value = '#3B82F6';\n                    categorySelect.value = 'general';\n                    \n                    // Refresh the filter and table\n                    setupTagFilter();\n                    loadEvidenceTable();\n                    \n                    alert('Tag created successfully!');\n                } catch (error) {\n                    alert('Failed to create tag: ' + error.message);\n                }\n            });\n        }\n\n        // Setup tag filter\n        function setupTagFilter() {\n            tagManager.createTagFilter('tag-filter', (filteredEvidence) => {\n                if (filteredEvidence) {\n                    loadEvidenceTable(filteredEvidence);\n                } else {\n                    loadEvidenceTable();\n                }\n            });\n        }\n\n        // Setup batch operations\n        function setupBatchOperations() {\n            batchTagInput = tagManager.createTagInput('batch-tag-input', {\n                placeholder: 'Select tags to apply...',\n                maxTags: 5,\n                onTagAdd: (tags) => {\n                    updateBatchButton();\n                }\n            });\n\n            // Select all button\n            document.getElementById('select-all-btn').addEventListener('click', () => {\n                const checkboxes = document.querySelectorAll('.evidence-checkbox');\n                checkboxes.forEach(cb => {\n                    cb.checked = true;\n                    selectedEvidence.add(parseInt(cb.value));\n                });\n                updateSelectionInfo();\n                updateBatchButton();\n            });\n\n            // Clear selection button\n            document.getElementById('clear-selection-btn').addEventListener('click', () => {\n                const checkboxes = document.querySelectorAll('.evidence-checkbox');\n                checkboxes.forEach(cb => cb.checked = false);\n                selectedEvidence.clear();\n                updateSelectionInfo();\n                updateBatchButton();\n            });\n\n            // Apply batch tags button\n            document.getElementById('apply-batch-tags-btn').addEventListener('click', async () => {\n                const selectedTags = batchTagInput.getSelectedTags();\n                if (selectedTags.length === 0 || selectedEvidence.size === 0) {\n                    alert('Please select evidence items and tags');\n                    return;\n                }\n\n                try {\n                    const tagIds = selectedTags.map(t => t.id);\n                    const evidenceIds = Array.from(selectedEvidence);\n                    \n                    await tagManager.batchTag(evidenceIds, tagIds);\n                    \n                    // Clear selections and refresh\n                    selectedEvidence.clear();\n                    batchTagInput.clearTags();\n                    loadEvidenceTable();\n                    updateSelectionInfo();\n                    updateBatchButton();\n                    \n                    alert(`Successfully tagged ${evidenceIds.length} evidence items!`);\n                } catch (error) {\n                    alert('Failed to apply batch tags: ' + error.message);\n                }\n            });\n        }\n\n        // Load evidence table\n        function loadEvidenceTable(evidenceData = mockEvidence) {\n            const tbody = document.getElementById('evidence-tbody');\n            \n            tbody.innerHTML = evidenceData.map(evidence => {\n                const evidenceTags = evidence.tags.map(tagId => {\n                    const tag = tagManager.getTag(tagId);\n                    return tag ? `<span class=\"evidence-tag\" style=\"background-color: ${tag.color}\">${tag.name}</span>` : '';\n                }).join('');\n\n                return `\n                    <tr>\n                        <td><input type=\"checkbox\" class=\"evidence-checkbox\" value=\"${evidence.id}\"></td>\n                        <td>${evidence.id}</td>\n                        <td>${evidence.name}</td>\n                        <td>${evidence.type}</td>\n                        <td><div class=\"evidence-tags\">${evidenceTags}</div></td>\n                        <td>\n                            <button type=\"button\" class=\"batch-button\" onclick=\"editEvidenceTags(${evidence.id})\">Edit Tags</button>\n                        </td>\n                    </tr>\n                `;\n            }).join('');\n\n            // Add event listeners to checkboxes\n            document.querySelectorAll('.evidence-checkbox').forEach(checkbox => {\n                checkbox.addEventListener('change', (e) => {\n                    const evidenceId = parseInt(e.target.value);\n                    if (e.target.checked) {\n                        selectedEvidence.add(evidenceId);\n                    } else {\n                        selectedEvidence.delete(evidenceId);\n                    }\n                    updateSelectionInfo();\n                    updateBatchButton();\n                });\n            });\n\n            // Master checkbox\n            document.getElementById('select-all-checkbox').addEventListener('change', (e) => {\n                const checkboxes = document.querySelectorAll('.evidence-checkbox');\n                checkboxes.forEach(cb => {\n                    cb.checked = e.target.checked;\n                    const evidenceId = parseInt(cb.value);\n                    if (e.target.checked) {\n                        selectedEvidence.add(evidenceId);\n                    } else {\n                        selectedEvidence.delete(evidenceId);\n                    }\n                });\n                updateSelectionInfo();\n                updateBatchButton();\n            });\n        }\n\n        // Update selection info\n        function updateSelectionInfo() {\n            const info = document.getElementById('selection-info');\n            info.textContent = `${selectedEvidence.size} evidence item(s) selected`;\n        }\n\n        // Update batch button state\n        function updateBatchButton() {\n            const button = document.getElementById('apply-batch-tags-btn');\n            const hasSelection = selectedEvidence.size > 0;\n            const hasTags = batchTagInput && batchTagInput.getSelectedTags().length > 0;\n            \n            button.disabled = !hasSelection || !hasTags;\n        }\n\n        // Edit evidence tags (placeholder function)\n        function editEvidenceTags(evidenceId) {\n            alert(`Edit tags for evidence ID: ${evidenceId}\\n\\nThis would open a tag editor modal in a full implementation.`);\n        }\n\n        // Initialize when page loads\n        document.addEventListener('DOMContentLoaded', initializeTagging);\n    </script>\n</body>\n</html>